# 2. 機能仕様

## 2.1 ターゲットユーザー

### 2.1.1 ゲスト（宿泊者）
*   **特徴:** 自分のスマートフォンを使って、より便利でパーソナルな滞在体験を求める旅行者。非接触でのサービス利用を好む。
*   **ニーズ:** 簡単に情報にアクセスしたい、不明点をすぐに解消したい、地元のユニークな体験を見つけたい。

### 2.1.2 ホスト（施設管理者・運営者）
*   **特徴:** 複数の民泊施設を管理している、またはサービス品質を向上させつつ運営コストを削減したい。
*   **ニーズ:** ゲスト対応の自動化、FAQ対応の効率化、特別なサービス提供によるゲスト満足度向上、レビュー獲得。

## 2.2 主要機能のユーザーストーリー

### 2.2.1 AIコンシェルジュ機能
*   **AS A ゲスト、I WANT 質問や要望を自然な言葉で入力できること、SO THAT 自分の知りたい情報を手軽に得られる。**
    *   **説明:** チャットUIを通じて、AIコンシェルジュに「近くのおすすめのレストランを教えて」「チェックアウトの時間はいつ？」といった質問を自由に入力できる。
    *   **受入条件:**
        *   チャットUIにテキストメッセージを入力し、送信できること。
        *   AIからの返答がチャット履歴に表示されること。
        *   複数回のやり取りで文脈を理解した応答ができること。
*   **AS A ゲスト、I WANT AIからテキストだけでなく、地図や写真、リンクなどのリッチな情報を受け取れること、SO THAT 視覚的にも分かりやすく、次のアクションに繋がりやすい。**
    *   **説明:** AIが場所を推薦した場合、その場所のカード形式の情報（名前、画像、住所、評価、口コミ数など）と、地図表示ボタン、ウェブサイトへのリンクなどが提示される。
    *   **受入条件:**
        *   AIからのレスポンスに `place_card` や `quick_reply` などの構造化データが含まれる場合、それらをUIに適切にレンダリングできること。
        *   `place_card` の地図ボタンを押すと、Google Mapsなどの外部地図アプリが起動し、指定された場所が表示されること。
        *   `link` ボタンを押すと、指定されたURLがブラウザで開かれること。
*   **AS A ゲスト、I WANT AIから提案されたクイックリプライ（ボタン）をタップできること、SO THAT メッセージを入力する手間なく、スムーズに会話を続けられる。**
    *   **説明:** AIの返答の一部として、次に繋がりやすい質問や選択肢がボタンとして提示され、それをタップすることでメッセージ送信と同様の処理が行われる。
    *   **受入条件:**
        *   `quick_reply` ボタンがUIに表示されること。
        *   ボタンをタップすると、そのボタンのテキストがユーザーのメッセージとして送信されること。

### 2.2.2 オンラインチェックイン・アウト機能 (AIコンシェルジュ経由)
*   **AS A ゲスト、I WANT AIに「チェックインしたい」と伝えること、SO THAT チェックイン手続きの画面に誘導され、自分のスマートフォンで完結できる。**
    *   **説明:** AIがチェックインの手順を案内し、専用のチェックインフォームへのリンクまたは画面遷移を提案する。
    *   **受入条件:**
        *   AIがチェックイン関連のメッセージを認識し、適切なガイダンスと遷移（またはリンク）を提示すること。

### 2.2.3 アメニティリクエスト機能 (AIコンシェルジュ経由)
*   **AS A ゲスト、I WANT AIに「タオルが欲しい」と伝えること、SO THAT AIからアメニティ選択画面に誘導され、数量を指定してリクエストできる。**
    *   **説明:** AIがアメニティリクエストのフローを開始し、利用可能なアメニティのリストと数量選択インターフェースへの遷移（またはリンク）を提案する。
    *   **受入条件:**
        *   AIがアメニティリクエスト関連のメッセージを認識し、適切なガイダンスと遷移（またはリンク）を提示すること。

## 2.3 画面遷移イメージ (AIコンシェルジュ中心)

```mermaid
graph TD
    A[ゲストのスマートフォン] --> B{Webアプリ起動};
    B --> C[チャット画面 (初期表示)];
    C -- 質問入力 --> D[AI応答受信];
    D -- テキスト返答 --> C;
    D -- place_card返答 --> E[場所カード表示];
    E -- 地図ボタンタップ --> F[Google Maps起動];
    D -- quick_reply返答 --> G[クイックリプライボタン表示];
    G -- ボタンタップ --> D;
    C -- "チェックインしたい" --> H[AI: チェックイン画面へ誘導];
    H --> I[チェックイン画面];
    C -- "タオルが欲しい" --> J[AI: アメニティリクエストへ誘導];
    J --> K[アメニティリクエスト画面];
```